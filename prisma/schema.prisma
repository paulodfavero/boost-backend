generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organization {
  id                       String               @id @default(dbgenerated("nanoid(11)"))
  created_at               DateTime             @default(now())
  name                     String
  password                 String?
  cnpj                     String?              @unique
  cpf                      String?              @unique
  email                    String?              @unique
  stripe_customer_id       String?
  updated_at               DateTime?            @default(now())
  welcome_email_sent       Boolean              @default(false)
  plan                     String               @default("FREE")
  trial_end                DateTime?
  trial_start              DateTime?
  apple_iap_transaction_id String?
  AccessLog                AccessLog[]
  BankTypeAccount          BankTypeAccount[]
  Bank                     Bank[]
  Category                 Category[]
  Company                  Company[]
  Credit                   Credit[]
  CreditsProjection        CreditsProjection[]
  Expense                  Expense[]
  ExpensesProjection       ExpensesProjection[]
  Gain                     Gain[]
  GainsProjection          GainsProjection[]
  Goals                    Goals[]
  Investment               Investment[]
  Suggestion               Suggestion[]
  User                     User[]
  Wallet                   Wallet[]
  FinancialScore           FinancialScore[]
  Bill                     Bill[]

  @@map("organizations")
}

model Expense {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("expenses")
}

model Gain {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("gains")
}

model Credit {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("credits")
}

model Category {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  name           String
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("categories")
}

model CategoryCreditCard {
  id                    String                  @unique
  created_at            DateTime                @default(now())
  description           String
  descriptionTranslated String
  SubCategoryCreditCard SubCategoryCreditCard[]

  @@map("categoriesCreditCard")
}

model SubCategoryCreditCard {
  id                    String             @unique
  created_at            DateTime           @default(now())
  description           String
  descriptionTranslated String
  parentDescription     String
  categoryCreditCardId  String
  category              CategoryCreditCard @relation(fields: [categoryCreditCardId], references: [id])

  @@map("subCategoriesCreditCard")
}

model Company {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  name           String
  cnpj           String?
  category       String?
  business_name  String?
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("companies")
}

model Bank {
  id                 String               @id @default(dbgenerated("nanoid(11)"))
  created_at         DateTime             @default(now())
  item_id            String               @unique
  name               String
  primary_color      String
  institution_url    String
  type               String
  image_url          String
  has_mfa            Boolean
  products           String[]
  status             String
  last_updated_at    DateTime?
  organizationId     String
  name_alias         String?
  bankTypeAccount    BankTypeAccount[]
  organization       Organization         @relation(fields: [organizationId], references: [id])
  Credit             Credit[]
  CreditsProjection  CreditsProjection[]
  expense            Expense[]
  ExpensesProjection ExpensesProjection[]
  Gain               Gain[]
  GainsProjection    GainsProjection[]
  Investment         Investment?

  @@map("banks")
}

model BankTypeAccount {
  id                          String               @id @default(dbgenerated("nanoid(11)"))
  created_at                  DateTime             @default(now())
  type                        String
  subtype                     String
  name                        String
  marketing_name              String?
  owner                       String
  balance                     Float
  currency_code               String
  tax_number                  String?
  account_id                  String               @unique
  item_id                     String
  number                      String
  last_updated_at             DateTime?
  bank_data                   String?
  credit_data                 String?
  bankItemId                  String
  organizationId              String?
  bankId                      String?
  name_alias                  String?
  is_bank_visible             Boolean?             @default(true)
  balance_close_date_week_day String?
  balance_due_date_week_day   String?
  bank                        Bank                 @relation(fields: [bankItemId], references: [item_id])
  organization                Organization?        @relation(fields: [organizationId], references: [id])
  Credit                      Credit[]
  CreditsProjection           CreditsProjection[]
  expense                     Expense[]
  ExpensesProjection          ExpensesProjection[]
  Gain                        Gain[]
  GainsProjection             GainsProjection[]

  @@map("bankTypeAccount")
}

model User {
  id             String       @id @default(cuid())
  created_at     DateTime     @default(now())
  name           String?
  email          String?      @unique
  emailVerified  DateTime?
  image          String?
  organizationId String
  accounts       Account[]
  sessions       Session[]
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("users")
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Suggestion {
  id              String       @id @default(dbgenerated("nanoid(11)"))
  created_at      DateTime     @default(now())
  amount_by_month Int
  is_useful       Boolean
  message         String?
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("suggestions")
}

model Goals {
  id              String       @id @default(dbgenerated("nanoid(11)"))
  created_at      DateTime     @default(now())
  updated_at      DateTime?    @default(now())
  name            String
  description     String
  amount          Int
  currentAmount   Int          @default(0)
  initiation_date DateTime
  expiration_date DateTime
  organizationId  String
  organization    Organization @relation(fields: [organizationId], references: [id])

  @@map("goals")
}

model FinancialScore {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  updated_at     DateTime?    @default(now())
  score          Int
  evolution      Json
  summary        String
  organizationId String       @unique
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("financial_scores")
}

model Investment {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  updated_at     DateTime?    @default(now())
  investments    String
  organizationId String
  bankId         String?      @unique
  bank           Bank?        @relation(fields: [bankId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("investments")
}

model AccessLog {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  updated_at     DateTime     @default(now())
  organizationId String
  user_agent     String?
  ip_address     String?
  device_type    String?
  browser        String?
  os             String?
  location       String?
  platform       String?
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("access_logs")
}

model Wallet {
  id             String       @id @default(dbgenerated("nanoid(11)"))
  created_at     DateTime     @default(now())
  updated_at     DateTime     @default(now())
  name           String
  balance        Int          @default(0)
  organizationId String
  organization   Organization @relation(fields: [organizationId], references: [id])

  @@map("wallets")
}

model ExpensesProjection {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("expenses_projection")
}

model GainsProjection {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("gains_projection")
}

model CreditsProjection {
  id                        String           @id @default(dbgenerated("nanoid(11)"))
  created_at                DateTime         @default(now())
  expiration_date           DateTime
  purchase_date             DateTime?
  balance_close_date        DateTime?
  bank_transaction_id       String?          @unique
  description               String
  company                   String
  category                  String?
  amount                    Int
  type_payment              String
  operation_type            String?
  payment_data              String?
  installment_current       Int?
  installment_total_payment Int?
  paid                      Boolean          @default(false)
  isHidden                  Boolean          @default(false)
  group_installment_id      String?
  organizationId            String
  bankId                    String?
  bankTypeAccountId         String?
  bank                      Bank?            @relation(fields: [bankId], references: [id])
  bankTypeAccount           BankTypeAccount? @relation(fields: [bankTypeAccountId], references: [id])
  organization              Organization     @relation(fields: [organizationId], references: [id])

  @@map("credits_projection")
}

model Bill {
  id                    String       @id @default(dbgenerated("nanoid(11)"))
  created_at            DateTime     @default(now())
  updated_at            DateTime     @default(now())
  description           String
  company               String?
  category              String?
  amount                Int
  expiration_date       DateTime
  day_of_month          Int // Dia do mês em que a conta vence (1-31)
  paid                  Boolean      @default(false)
  active                Boolean      @default(true) // Se a conta está ativa (para criar mês a mês)
  source_transaction_id String? // ID da transação original que gerou a sugestão
  organizationId        String
  organization          Organization @relation(fields: [organizationId], references: [id])

  @@map("bills")
}
